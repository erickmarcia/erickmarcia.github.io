{"title":"Actualizar Consecutivo con formato \"CON-2022-000\" en SQL","slug":"Actualizar-Consecutivo-con-SQL","html":"<p>Uno de los problemas que comunmente nos encontramos es el trabajar con\nconsecutivos y más cuando estos estan estructurados con caracteres y números, ya\nque se dificulta el poder aumentarlos.</p>\n<p>En este post trateremos de poder resolver este problema, para ello vamos a\nutilizar una estructura de datos que nos permita almacenar los consecutivos, y\nuna funcion que nos permita actualizarlos.</p>\n<h2 id=\"diseño-tabla-consecutivos\">Diseño Tabla Consecutivos</h2>\n<p>Para este ejemplo necesitaremos una tabla donde guardaremos los consecutivo a\nutilizar en nuestro sistema con los siguientes campos:</p>\n<p><img src=\"media/blog/SQL/Consecutivo/1-Consecutivo.png\" alt=\"ERROR #1115\"></p>\n<p>Una vez que tenemos la tabla con los datos a ocupar, podemos buscar el campo con\nel consecutivo a aumentar en este caso el campo [ultimoValor]:</p>\n<p><img src=\"media/blog/SQL/Consecutivo/2-Consecutivo.png\" alt=\"ERROR #1115\"></p>\n<h2 id=\"creando-función-rellenar-con-ceros\">Creando Función Rellenar con Ceros</h2>\n<p>A continuación vamos a crear un función que nos ayudara al momento de aumentar\nel consecutivo rellenando con ceros según la longitud requerida, la cual\nllamaremos [fncRellenarConCeros], esta función recibira 2 parametros:</p>\n<ol>\n<li>[@numero] = Consecutivo</li>\n<li>[@longitudRequerida] = Longitud del consecutivo .</li>\n</ol>\n<p><img src=\"media/blog/SQL/Consecutivo/3-Consecutivo.png\" alt=\"ERROR #1115\"></p>\n<blockquote>\n<p>Nota: Si no deseas crear la función [fncRellenarConCeros], puedes utilizarla\nscript que se útiliza dentro de la función [fncDameNuevoConsecutivo] para\nrellenar los ceros.</p>\n</blockquote>\n<h2 id=\"creando-función-dame-nuevo-consecutivo\">Creando Función Dame Nuevo Consecutivo</h2>\n<p>A continuación vamos a crear un función la cual llamaremos\n[dbo].[fncDameNuevoConsecutivo], esta función recibira 1 parametro:</p>\n<ol>\n<li>[@CODIGO] = Código del Consecutivo o el identificador del consecutivo que\nnecesitamos, cabe aclarar que este parametro lo ocupamos porque estamos\nusando una tabla consecutivos donde se guardan todos los consecutivos que se\npueden utilizar en nuestro sistema.</li>\n</ol>\n<p>Dentro de la función [dbo].[fncDameNuevoConsecutivo] vamos a realizar los\nsiguientes pasos:</p>\n<ol>\n<li>Declaramos las variables a ocupar</li>\n</ol>\n<pre class=\"language-\"><code class=\"language-\">    DECLARE @nuevo_consecutivo NVARCHAR(MAX);\n    DECLARE @consecutivo_global NVARCHAR(MAX);\n    DECLARE @consecutivo INT;\n</code></pre><ol start=\"2\">\n<li>Obtenemos el último valor o consecutivo guardado y lo asignamos a nuestra\nvariable consecutivo_global.</li>\n</ol>\n<pre class=\"language-\"><code class=\"language-\">       SET @consecutivo_global = (SELECT [C].[ULTIMOVALOR] FROM [Base].[CONSECUTIVO] AS [C] WHERE [C].[CODIGO]  IN (@CODIGO))\n</code></pre><ol start=\"3\">\n<li>Separamos nuestro consecutivo, para ello vamos a seleccionar el parte que se\ndesea incrementar que debe de ser número, en mi caso de derecha a izquierda 3\ndigitos, le sumamos 1 y lo asignamos a la variable consecutivo.</li>\n</ol>\n<pre class=\"language-\"><code class=\"language-\">       SET @consecutivo = RIGHT(@consecutivo_global,3) + 1\n</code></pre><ol start=\"4\">\n<li>Por último obtenemos la parte del consecutivo que no varia en mi caso de\nizquierda a derecha los primeros 9 caracteres con la función LEFT de SQL, lo\nconcatenamos con el resultado obtenido al ejecutar la función antes creada\n[fncRellenarConCeros] y lo asignamos a la variable nuevo_consecutivo.</li>\n</ol>\n<pre class=\"language-\"><code class=\"language-\">  SELECT @nuevo_consecutivo = LEFT(@consecutivo_global,9) + [dbo].[fncRellenarConCeros](@consecutivo, 3)\n</code></pre><ol start=\"5\">\n<li>para terminar nuestra función retornamos la variable nuevo_consecutivo.</li>\n</ol>\n<pre class=\"language-\"><code class=\"language-\">     RETURN @nuevo_consecutivo;\n</code></pre><p>El resultado final será de nuestra función es el siguiente:</p>\n<p><img src=\"media/blog/SQL/Consecutivo/4-Consecutivo.png\" alt=\"ERROR #1115\"></p>\n<h2 id=\"probando-función\">Probando Función</h2>\n<p>A continuación procederemos a ejeccutar la función\n[dbo].[fncDameNuevoConsecutivo] dentro de un SELECT quedando de la siguiente\nmanera:</p>\n<p><img src=\"media/blog/SQL/Consecutivo/5-Consecutivo.png\" alt=\"ERROR #1115\"></p>\n<h2 id=\"revisando-función\">Revisando Función</h2>\n<p>Si deseas ver donde se encuentran las funciones que creamos.</p>\n<p>Selecciona la base de datos -&gt; Procedimientos -&gt; Funciones -&gt; Funciones\nEscalares</p>\n<p><img src=\"media/blog/SQL/Consecutivo/6-Consecutivo.png\" alt=\"ERROR #1115\"></p>\n<h2 id=\"conclusiones\">Conclusiones</h2>\n<p>Se que hay muchas opciones en internet para resolver este problema, pero esta es\nuna de las que me ha funcionado.</p>\n<p>Te invito a que la puedas probar, si deseas agregarle alguna funcionalidad\nextra, no dudes en compartirla.</p>\n<p>Puedes descargar los scripts utilizados desde mi repositorio en\n<a target=\"_blank\" rel=\"nofollow\" href=\"https://github.com/erickmarcia/SQL\">GitHub</a></p>\n","date":"2022-01-05T23:52:00.000+00:00","feature_image":"media/blog/SQL/Consecutivo/Banner.jpg","excerpt":"","printDate":"January 5, 2022","printReadingTime":"3 min read"}